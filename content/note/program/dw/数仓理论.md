---
title: "数仓理论"
date: 2023-07-06T19:41:37+08:00
lastmod: 2023-07-06T19:41:37+08:00
author: ["AlfredNing"]
keywords: 
- 
categories: # 没有分类界面可以不填写
- 
tags: # 标签
- 数仓
description: ""
weight:
slug: ""
draft: false # 是否为草稿
comments: true # 本页面是否显示评论
reward: true # 打赏
mermaid: true #是否开启mermaid
showToc: true # 显示目录
TocOpen: true # 自动展开目录
hidemeta: false # 是否隐藏文章的元信息，如发布日期、作者等
disableShare: true # 底部不显示分享栏
showbreadcrumbs: true #顶部显示路径
cover:
    image: "" #图片路径例如：posts/tech/123/123.png
    caption: "" #图片底部描述
    alt: ""
    relative: false
---

# 数据模型简介

## 模型的定义

表：负责数据真实存储

模型：在表的基础上多了**业务含义**，侧重点：使用角度、业务

作用：更好的存储、组织数据、在性能、成本、效率和质量取得最佳平衡

## 建模方法论

### ER建模

对三范式要求更高，基于三范式

缺点：

- 需要全面了解业务和数据
- 实施周期比较长
- 对建模人员要求比较高

优点：

- 冗余少

### 维度建模

对数据冗余的宽容度比较高

基于维度和事实构建

### Data  Valut模型

### Anchor模型

## 数仓体系

![image-20230706202454219](https://nq-bucket.oss-cn-shanghai.aliyuncs.com/note_img/image-20230706202454219.png)



# 主题域划分

面向业务分析，将业务过程或者维度抽象集合。

可以划分多级主题域

# 指标体系

- 原子指标
- 派生指标
- 衍生指标

派生指标 = 原子指标 + 时间周期修饰词 + 其他修饰词

原子指标： 动作 + 度量，例如：支付金额

修饰词：1d/2h, 只有时间周期有英文名

# 模型层次

- 操作数据层：ods
- 公共维度模型层：cdm
  - 明细层：dwd
  - 汇总数据层：dws
- 应用数据层：ads

## ODS层

业务操作数据几乎无处理存放在数据仓库中

## CDM层

存放明细事实表，维表数据及公共指标数据

## ADS层

存放数据产品个性化的统计指标数据，根据CDM层与ODS层加工生成

# 模型设计基本原则

- 高内聚 低耦合： 将业务相同，粒度相同的数据设计为同一个逻辑或模型，将高概率同时访问的数据放在一起，将低概率同时访问的数据分开存储
- 核心模型与扩展模型分离
- 公共处理逻辑下沉及单一
- 成本与性能平衡
- 数据可回滚
- 一致性

# 数仓构建流程

## 指导方针

业务调研：自下而上

需求分析：自上而下

1. 维度建模
2. 构建总线矩阵
3. 抽象出业务过程和维度
4. 报表需求抽象出指标体系
5. 结合工具，完成指标规范定义和模型设计
6. 代码研发和运维

> 数仓的规范性特别重要

# 维度设计

维度所包含表示维度的列：维度属性。查询约束、条件、分组和报表标签产生来源	 

主键：维度使用主键表示其唯一性

- 代理键：不具有业务含义的键，一般用于缓慢变化维
- 自然键：具有业务含义的键

## 维度设计基本方法

**维度设计的过程就是确定维度属性过程**

数据仓库的能力直接与维度属性的质量和深度成正比

维度具有层级结构

维度具有特殊维度

# 事实表

**维度+度量**

事实表的一行记录所描述业务细节程度称为粒度

- 事务事实表
- 周期快照事实表
- 累计快照事实表