---
title: "类的加载"
date: 2023-02-23T20:16:54+08:00
lastmod: 2023-02-23T20:16:54+08:00
author: ["AlfredNing"]
keywords: 
- 
categories: # 没有分类界面可以不填写
- 
tags: # 标签
- jvm
description: ""
weight:
slug: ""
draft: false # 是否为草稿
comments: true # 本页面是否显示评论
reward: true # 打赏
mermaid: true #是否开启mermaid
showToc: true # 显示目录
TocOpen: true # 自动展开目录
hidemeta: false # 是否隐藏文章的元信息，如发布日期、作者等
disableShare: true # 底部不显示分享栏
showbreadcrumbs: true #顶部显示路径
cover:
    image: "" #图片路径例如：posts/tech/123/123.png
    caption: "" #图片底部描述
    alt: ""
    relative: false
---

# 类的加载过程

> Java数据类型分为数据基本数据类型和引用数据类型
>
> 基本类型由虚拟机预先定义，引用类型需要进行类的加载

类的加载大过程分为三步, 总过程七步

![image-20230223202441994](https://nq-bucket.oss-cn-shanghai.aliyuncs.com/note_img/image-20230223202441994.png)

## 装载

**将java的class文件加载到机器内存，并在内存中构建出Java类的原型-类模板对象**

查找类的二进制文件，生成class实例

加载类，需要完成以下三件事情：

- 通过类的全名，获取类的二进制数据流
- 解析类的二进制数据流转换为方法区的数据结构(**Java类模型**)
- 创建java.lang.class类的实例，表示该类型

### 类模板对象

Java类在内存中的一个快照，JVM从字节码文件解析出来的常量池、类字段、类方法等类信息存储到类模板中。在运行期通过类模板获取Java类的任意信息，能够对Java类的成员变量进行遍历，进行方法调用。**反射机制也是基于此，如果没有存储Java类的声明信息，JVM在运行期也无法进行反射**

### 获取二进制数据流

class字节码文件符号JVM规范

- 通过读取class后缀的文件
- 读入jar、zip等归档数据包，提取类文件(热部署jar包原理基础)
- 事先存放在数据库的二进制数据
- 使用类型Http之类的协议通过网络进行加载
- 在运行时生成一段class的二进制信息等

### class实例位置

类将.class文件加载至元空间后，会在堆中创建一个Java.lang.Class对象，用来封装类位于方法区内的数据结构，该Class对象是在加载类的过程中创建的，每个类都对应有一个Class类型的对象![image-20230223203835960](https://nq-bucket.oss-cn-shanghai.aliyuncs.com/note_img/image-20230223203835960.png)

### 数组类的加载

数组类本身不是由类加载器负责创建，而是由JVM在运行时根据需要去创建。加载器只负责加载数据元素的数据类型(基本数据类型和引用数据类型)，申请内存分配长度